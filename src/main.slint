import { Button, VerticalBox, HorizontalBox, LineEdit, StandardButton } from "std-widgets.slint";
import { Slider } from "std-widgets.slint";

export component MainWindow inherits Window {
    title: "Office 文档压缩工具";
    preferred-width: 400px;
    preferred-height: 600px;
    icon: @image-url("../icon.svg");
    // no-frame: true;
    
    // 回调函数定义
    callback select-file();
    callback compress-file();
    
    // 属性定义
    in-out property <string> file-path: "";
    in-out property <string> status-text: "请选择要压缩的 Office 文档";
    in-out property <bool> is-processing: false;
    in-out property <float> progress: 0.0;
    in-out property <float> image-quality: 0.8; // 图片压缩率 0.0~1.0
    in-out property <string> current-step: ""; // 当前处理步骤
    in-out property <int> total-images: 0; // 总图片数
    in-out property <int> processed-images: 0; // 已处理图片数
    
    VerticalBox {
        padding: 20px;
        spacing: 15px;
        
        // 标题
        Text {
            text: "Office 文档压缩工具";
            font-size: 24px;
            font-weight: 700;
            horizontal-alignment: center;
        }
        
        // 文件选择区域
        HorizontalBox {
            spacing: 10px;
            Text {
                text: "选择文件:";
                vertical-alignment: center;
                preferred-width: 80px;
            }
            LineEdit {
                text <=> root.file-path;
                placeholder-text: "选择 .docx 或 .pptx 文件";
                read-only: true;
                horizontal-stretch: 1;
            }
            Button {
                text: "浏览...";
                clicked => { root.select-file(); }
            }
        }
        // 图片压缩率调节
        HorizontalBox {
            spacing: 10px;
            Text {
                text: "图片压缩率:";
                vertical-alignment: center;
                preferred-width: 80px;
            }
            Slider {
                value <=> root.image-quality;
                minimum: 0.1;
                maximum: 1.0;
                step: 0.01;
                horizontal-stretch: 1;
            }
            Text {
                text: Math.round(root.image-quality * 100) + "%";
                vertical-alignment: center;
                preferred-width: 50px;
            }
        }
        
        // 压缩按钮
        Button {
            text: root.is-processing ? "压缩中..." : "开始压缩";
            enabled: root.file-path != "" && !root.is-processing;
            primary: true;
            clicked => {
                root.compress-file();
            }
        }
        
        // 进度条
        Rectangle {
            height: 30px;
            border-width: 2px;
            border-color: #007acc;
            border-radius: 5px;
            
            Rectangle {
                width: parent.width * root.progress;
                height: parent.height;
                background: #007acc;
                border-radius: 5px;
            }
            
            Text {
                text: root.progress > 0 ? Math.round(root.progress * 100) + "%" : "";
                horizontal-alignment: center;
                vertical-alignment: center;
                color: root.progress > 0.5 ? white : black;
                font-weight: 700;
            }
        }
        
        // 加载动画（仅处理时显示）
        if root.is-processing : HorizontalBox {
            alignment: center;
            spacing: 10px;
            Rectangle {
                width: 40px;
                height: 40px;
                border-width: 4px;
                border-color: #007acc;
                border-radius: 20px;
                opacity: 0.3 + 0.7 * Math.abs(Math.sin(animation-tick() / 1s * 3.14159deg));
            }
            Text {
                text: root.current-step;
                font-size: 14px;
                color: #007acc;
                font-weight: 600;
            }
        }
        
        // 状态信息
        Rectangle {
            background: #f5f5f5;
            border-width: 1px;
            border-color: #ddd;
            border-radius: 5px;
            vertical-stretch: 1;
            
            VerticalBox {
                padding: 10px;
                
                Text {
                    text: root.status-text;
                    wrap: word-wrap;
                    vertical-alignment: top;
                }
            }
        }
        
        // 底部说明
        Text {
            text: "支持 .docx 和 .pptx 文件压缩";
            font-size: 12px;
            color: #666;
            horizontal-alignment: center;
        }
    }
}
